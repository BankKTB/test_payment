<div mat-dialog-title>
  <button (click)="onNoClick()" class="close" mat-button>X</button>
  <h1 cdkDrag cdkDragHandle cdkDragRootElement=".cdk-overlay-pane">
    <b>กลับรายการเอกสาร</b>
  </h1>
</div>
<div [hidden]="chooseFile" mat-dialog-content style="width: 1200px;">
  <div class="content-box">
    <div [hidden]="dataSourcePull.data.length > 0" style="overflow: auto; max-height: 500px;">
      <table [dataSource]="dataSource" class="mat-elevation-z8" mat-table matSort>
        <ng-container matColumnDef="choose">
          <th *matHeaderCellDef class="info" mat-header-cell>เลือก</th>
          <td *matCellDef="let element" mat-cell>
            <mat-icon (click)="viewDocument(element)" class="icon pointer">
              folder_open
            </mat-icon>
          </td>
        </ng-container>

        <ng-container matColumnDef="compCode">
          <th style="width: 100px;" *matHeaderCellDef class="info" mat-header-cell>รหัสหน่วยงาน</th>
          <td *matCellDef="let element" mat-cell>
            {{ element.compCode }}
          </td>
        </ng-container>

        <ng-container matColumnDef="accountDocNo">
          <th *matHeaderCellDef class="info" mat-header-cell mat-sort-header>เลขที่เอกสาร</th>
          <td *matCellDef="let element" mat-cell>
            {{ element.accountDocNo }}
          </td>
        </ng-container>

        <ng-container matColumnDef="fiscalYear">
          <th *matHeaderCellDef class="info" mat-header-cell mat-sort-header>ปีบัญชี</th>
          <td *matCellDef="let element" mat-cell>
            {{ element.fiscalYear | thaiyear }}
          </td>
        </ng-container>
        <ng-container matColumnDef="compCodeAgency">
          <th style="width: 100px;" *matHeaderCellDef class="info" mat-header-cell>รหัสหน่วยงาน</th>
          <td *matCellDef="let element" mat-cell>
            {{ element.compCodeAgency }}
          </td>
        </ng-container>

        <ng-container matColumnDef="accountDocNoAgency">
          <th *matHeaderCellDef class="info" mat-header-cell mat-sort-header>เลขที่เอกสาร</th>
          <td *matCellDef="let element" mat-cell>
            {{ element.accountDocNoAgency }}
          </td>
        </ng-container>

        <ng-container matColumnDef="fiscalYearAgency">
          <th *matHeaderCellDef class="info" mat-header-cell mat-sort-header>ปีบัญชี</th>
          <td *matCellDef="let element" mat-cell>
            {{ element.fiscalYearAgency | thaiyear }}
          </td>
        </ng-container>
        <ng-container matColumnDef="reasonNo">
          <th style="width: 250px;" *matHeaderCellDef class="info" mat-header-cell mat-sort-header>
            เหตุผลการกลับรายการ
          </th>
          <td *matCellDef="let element" mat-cell>
            {{ element.reasonNo | reasonReverse }}
          </td>
        </ng-container>
        <ng-container matColumnDef="revDateAcct">
          <th *matHeaderCellDef class="info" mat-header-cell mat-sort-header>วันที่ผ่านรายการ</th>
          <td *matCellDef="let element" mat-cell>
            {{ element.revDateAcct | thaidate }}
          </td>
        </ng-container>

        <tr *matHeaderRowDef="displayedColumns; sticky: true" mat-header-row></tr>
        <tr
          (click)="row.highlighted = !row.highlighted"
          (mouseout)="row.hovered = false"
          (mouseover)="row.hovered = true"
          *matRowDef="let row; columns: displayedColumns"
          [ngClass]="{ hovered: row.hovered, highlighted: row.highlighted }"
          mat-row
        ></tr>
      </table>
      <mat-paginator [pageSizeOptions]="[5, 10, 20, 50, 100]" showFirstLastButtons></mat-paginator>
    </div>
    <div [hidden]="dataSourcePull.data.length === 0" style="overflow: auto; max-height: 500px;">
      <table [dataSource]="dataSourcePull" class="mat-elevation-z8" mat-table matSort>
        <ng-container matColumnDef="choose">
          <th *matHeaderCellDef class="info" mat-header-cell>เลือก</th>
          <td *matCellDef="let element" mat-cell>
            <mat-icon (click)="viewDocument(element)" class="icon pointer">
              folder_open
            </mat-icon>
          </td>
        </ng-container>

        <ng-container matColumnDef="companyCode">
          <th style="width: 100px;" *matHeaderCellDef class="info" mat-header-cell>รหัสหน่วยงาน</th>
          <td *matCellDef="let element" mat-cell>
            {{ element.companyCode }}
          </td>
        </ng-container>

        <ng-container matColumnDef="documentNo">
          <th *matHeaderCellDef class="info" mat-header-cell mat-sort-header>เลขที่เอกสาร</th>
          <td *matCellDef="let element" mat-cell>
            {{ element.documentNo }}
          </td>
        </ng-container>

        <ng-container matColumnDef="fiscalYear">
          <th *matHeaderCellDef class="info" mat-header-cell mat-sort-header>ปีบัญชี</th>
          <td *matCellDef="let element" mat-cell>
            {{ element.fiscalYear | thaiyear }}
          </td>
        </ng-container>
        <ng-container matColumnDef="companyCodeAgency">
          <th style="width: 100px;" *matHeaderCellDef class="info" mat-header-cell>รหัสหน่วยงาน</th>
          <td *matCellDef="let element" mat-cell>
            {{ element.companyCodeAgency }}
          </td>
        </ng-container>

        <ng-container matColumnDef="documentNoAgency">
          <th *matHeaderCellDef class="info" mat-header-cell mat-sort-header>เลขที่เอกสาร</th>
          <td *matCellDef="let element" mat-cell>
            {{ element.documentNoAgency }}
          </td>
        </ng-container>

        <ng-container matColumnDef="fiscalYearAgency">
          <th *matHeaderCellDef class="info" mat-header-cell mat-sort-header>ปีบัญชี</th>
          <td *matCellDef="let element" mat-cell>
            {{ element.fiscalYearAgency | thaiyear }}
          </td>
        </ng-container>
        <ng-container matColumnDef="reverseCompanyCode">
          <th *matHeaderCellDef class="info" mat-header-cell mat-sort-header>
            รหัสหน่วยงานเอกสารกลับรายการ
          </th>
          <td class="text-center" *matCellDef="let element" mat-cell>
            {{ element.reverseCompanyCode }}
          </td>
        </ng-container>
        <ng-container matColumnDef="reverseDocumentNo">
          <th *matHeaderCellDef class="info" mat-header-cell mat-sort-header>
            เลขที่เอกสารกลับรายการ
          </th>
          <td class="text-center" *matCellDef="let element" mat-cell>
            {{ element.reverseDocumentNo }}
          </td>
        </ng-container>
        <ng-container matColumnDef="reverseFiscalYear">
          <th *matHeaderCellDef class="info" mat-header-cell mat-sort-header>
            ปีบัญชีเอกสารกลับรายการ
          </th>
          <td class="text-center" *matCellDef="let element" mat-cell>
            {{ element.reverseFiscalYear ? (element.reverseFiscalYear | thaiyear) : '' }}
          </td>
        </ng-container>
        <ng-container matColumnDef="status">
          <th *matHeaderCellDef class="info" mat-header-cell mat-sort-header>สถานะ</th>
          <td *matCellDef="let element" mat-cell>
            <span *ngIf="element.status === 'P'">กำลังประมวลผล</span>
            <span *ngIf="element.status === 'S'">กลับรายการสำเร็จ</span>
            <span *ngIf="element.status === 'E'">กลับรายการไม่สำเร็จ</span>
          </td>
        </ng-container>

        <tr *matHeaderRowDef="displayedColumnsPull; sticky: true" mat-header-row></tr>
        <tr
          (click)="row.highlighted = !row.highlighted"
          (mouseout)="row.hovered = false"
          (mouseover)="row.hovered = true"
          *matRowDef="let row; columns: displayedColumnsPull"
          [ngClass]="{ hovered: row.hovered, highlighted: row.highlighted }"
          mat-row
        ></tr>
      </table>
      <div class="footer-table-summary">
        <div class="summary-result">
          <p>จำนวนรายการเอกสารทั้งหมด : {{ summaryResult?.total }} รายการ</p>
          <p>กำลังประมวลผล : {{ summaryResult?.process }} รายการ</p>
          <p>สำเร็จ : {{ summaryResult?.success }} รายการ</p>
          <p>ไม่สำเร็จ : {{ summaryResult?.fail }} รายการ</p>
        </div>
        <mat-paginator
          #paginatorPull
          [pageSizeOptions]="[5, 10, 20, 50, 100]"
          showFirstLastButtons
        ></mat-paginator>
      </div>
    </div>
    <div class="row mx-auto mt-3 border-t-black">
      <div *ngIf="!confirm" class="mx-auto d-flex">
        <button (click)="clickConfirm()" class="btn btn-success btn-lg" type="button">
          ยืนยัน
        </button>
        <button (click)="clickCancel()" class="btn btn-danger btn-lg" type="button">
          ยกเลิก
        </button>
        <!--        <button (click)="pullPaymentDocument()" class="btn-light" type="button">refresh</button>-->
      </div>
      <div *ngIf="confirm" class="mx-auto d-flex" style="width: 50%;">
        <button (click)="clickCancel()" class="btn btn-danger flex-1" type="button">
          ปิด
        </button>
        <button
          *ngIf="dataSourcePull.data.length > 0"
          (click)="pullMassReverseDocument(uuid)"
          class="btn btn-info flex-1"
          mat-icon-button
        >
          <mat-icon>sync</mat-icon>
          <span>รีเฟรช</span>
        </button>
      </div>
    </div>
  </div>
</div>

<div [hidden]="!chooseFile" mat-dialog-content style="width: 800px;">
  <div class="content-box">
    <div>
      <div cdkDragHandle class="header-dialog topic">
        <label for=""> เลือกไฟล์ </label>
        <button (click)="onNoClick()" class="close" type="button">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="content-dialog overflow-y max-h-400">
        <div class="row">
          <div class="col-12 col-md-2 d-flex align-items-center">
            <label class="m-0 text-underline-red"> ชื่อไฟล์ (.xls) </label>
          </div>
          <div class="col-12 col-md-10">
            <div class="custom-file pointer">
              <input
                (change)="onSelectedFile($event)"
                accept=".xlsx, .xls"
                class="custom-file-input"
                id="uploadFile"
                multiple="false"
                type="file"
              />
              <label class="custom-file-label" for="uploadFile">{{ fileName }}</label>
              <!-- <input type="file" (change)="onSelectedFile($event)" multiple="false" accept=".xlsx, .xls" /> -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <hr class="under-title" />
    <div class="mx-auto d-flex">
      <button (click)="upload()" class="btn btn-success btn-lg" type="button">
        อัพโหลด
      </button>
      <button (click)="clickCancel()" class="btn btn-danger btn-lg" type="button">
        ไม่ใช่
      </button>
    </div>
  </div>
</div>
