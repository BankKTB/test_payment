<div class="content-menu-top">
  <app-head-content></app-head-content>
  <div class="topic">
    <h4>ค้นหา Batch job</h4>
  </div>
</div>

<section class="mt-4">
  <form [formGroup]="searchBatchForm">
    <!-- Job Date -->
    <div class="row">
      <div class="col-12 col-sm-2">
        <label class="input-head"> Job Date </label>
      </div>
      <div class="col-12 col-sm-10 col-md-4">
        <div class="input-group datetime-input">
          <input
            [matDatepicker]="jobDate"
            formControlName="jobDate"
            class="form-control"
            type="text"
            appDateInput
          />
          <div class="datetime-input-append">
            <button (click)="jobDate.open()" class="btn-calendar-icon" type="button">
              <img src="assets/images/icon/calendar.svg" width="12px" />
              <mat-datepicker #jobDate></mat-datepicker>
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Payment Date -->
    <div class="row">
      <div class="col-12 col-sm-2">
        <label class="input-head"> Payment Date </label>
      </div>
      <div class="col-12 col-sm-10 col-md-4">
        <div class="input-group datetime-input">
          <input
            [matDatepicker]="paymentDate"
            formControlName="paymentDate"
            class="form-control"
            type="text"
            appDateInput
          />
          <div class="datetime-input-append">
            <button (click)="paymentDate.open()" class="btn-calendar-icon" type="button">
              <img src="assets/images/icon/calendar.svg" width="12px" />
              <mat-datepicker #paymentDate></mat-datepicker>
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Payment Name -->
    <div class="row">
      <div class="col-12 col-sm-2">
        <label class="input-head"> Payment Name </label>
      </div>
      <div class="col-12 col-sm-10 col-md-4">
        <div class="input-group">
          <input
            [ngClass]="{ active: searchBatchForm.controls.paymentName.value }"
            class="form-control"
            formControlName="paymentName"
            maxLength="5"
            type="text"
            appUpperCaseDirective
          />
          <!-- <span class="clear-input-icon" (click)="clearInput('reference')"> x </span> -->
          <div class="input-group-append">
            <button
              (click)="openDialogSearchParameterComponent()"
              class="btn btn-default"
              type="button"
            >
              <img src="assets/images/icon/menu.svg" width="12px" />
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Job Status -->
    <div class="row">
      <div class="col-12 col-sm-2">
        <label class="input-head"> Job Status </label>
      </div>
      <div class="col-12 col-sm-10 col-md-4">
        <div class="row no-gutters">
          <div class="col-6 col-sm-4 mb-4" *ngFor="let jobStatus of jobStatuses">
            <input
              type="checkbox"
              [formControlName]="jobStatus.formControlName"
              [value]="jobStatus.value"
            />
            {{ jobStatus.text }}
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-12 offset-0 col-sm-10 offset-sm-2 col-md-6">
        <button class="btn-gradient btn-bg-primary" (click)="loadBatchJob()" type="button">
          ค้นหา
        </button>
      </div>
    </div>
  </form>
  <ul class="warning-box">
    <li *ngFor="let c of listValidate">{{ c }}</li>
  </ul>
</section>
<section class="mt-5" [hidden]="!(dataSource.data.length > 0)">
  <div class="mb-3 mr-3 d-flex justify-content-end">
    <button type="button" (click)="loadBatchJob()" class="btn-gradient btn-bg-info d-flex">
      <mat-icon>refresh</mat-icon>
      <span>โหลด</span>
    </button>
  </div>
  <table mat-table [dataSource]="dataSource" matSort class="table-full-width">
    <ng-container matColumnDef="jobType">
      <th mat-header-cell *matHeaderCellDef width="10%">Job Type</th>
      <td mat-cell *matCellDef="let element">
        {{ element.jobType }}
      </td>
    </ng-container>

    <ng-container matColumnDef="jobName">
      <th mat-header-cell *matHeaderCellDef width="10%">Job Name</th>
      <td mat-cell *matCellDef="let element">
        {{
          element.jobType === 'PAYMENT'
            ? 'PAY_' +
              (element.paymentAlias?.paymentDate | datePattern: 'full') +
              '_' +
              element.paymentAlias?.paymentName
            : 'RETURN_' + (element.jobDate | datePattern: 'full')
        }}
      </td>
    </ng-container>

    <!-- Payment Date -->
    <ng-container matColumnDef="paymentDate">
      <th mat-header-cell *matHeaderCellDef width="10%">Payment Date</th>
      <td
        mat-cell
        [ngClass]="classClickAble(element.paymentAlias?.paymentName)"
        (click)="viewLogPayment(element)"
        *matCellDef="let element"
      >
        {{ element.paymentAlias?.paymentDate | datePattern: 'full' }}
      </td>
    </ng-container>

    <!-- Payment Name -->
    <ng-container matColumnDef="paymentName">
      <th mat-header-cell *matHeaderCellDef width="10%">Payment Name</th>
      <td
        mat-cell
        *matCellDef="let element"
        [ngClass]="classClickAble(element.paymentAlias?.paymentName)"
        (click)="viewLogPayment(element)"
      >
        {{ element.paymentAlias?.paymentName }}
      </td>
    </ng-container>

    <!-- Payment Name -->
    <ng-container matColumnDef="proposal">
      <th mat-header-cell *matHeaderCellDef width="10%">Proposal</th>
      <td mat-cell *matCellDef="let element">
        {{ element.paymentType == 0 ? 'X' : '' }}
      </td>
    </ng-container>

    <!-- Created By -->
    <ng-container matColumnDef="createdBy">
      <th mat-header-cell *matHeaderCellDef>Created By</th>
      <td mat-cell *matCellDef="let element">{{ element.createdBy ? element.createdBy : '-' }}</td>
    </ng-container>

    <!-- Status -->
    <!--    <ng-container matColumnDef="status">-->
    <!--      <th mat-header-cell *matHeaderCellDef>Status</th>-->
    <!--      <td mat-cell *matCellDef="let element">-->
    <!--        <b class="text-capitalize" [ngClass]="classStatus(element.status)">-->
    <!--          {{ (element.status) ? element.status.toLowerCase() : "" }}-->
    <!--        </b>-->
    <!--      </td>-->
    <!--    </ng-container>-->

    <!-- Job Status -->
    <ng-container matColumnDef="state">
      <th mat-header-cell *matHeaderCellDef>Job Status</th>
      <td mat-cell *matCellDef="let element">
        <b class="text-capitalize" [ngClass]="classJobStatus(element.state)">
          {{ element.state ? element.state.toLowerCase() : '' }}
        </b>
      </td>
    </ng-container>

    <!-- Schedule Date -->
    <ng-container matColumnDef="jobDate">
      <th mat-header-cell *matHeaderCellDef>Schedule Date</th>
      <td mat-cell *matCellDef="let element">
        {{
          element.triggerAtInMillis > 0 ? (element.triggerAtInMillis | datePattern: 'full') : '-'
        }}
      </td>
    </ng-container>

    <!-- Schedule Time -->
    <ng-container matColumnDef="runTime">
      <th mat-header-cell *matHeaderCellDef>Schedule Time</th>
      <td mat-cell *matCellDef="let element">
        {{
          element.triggerAtInMillis > 0 ? (element.triggerAtInMillis | timePattern: 'full') : '-'
        }}
      </td>
    </ng-container>

    <!-- Job Date -->
    <ng-container matColumnDef="startDate">
      <th mat-header-cell *matHeaderCellDef>Start Date</th>
      <td mat-cell *matCellDef="let element">
        {{
          element.startAtInMillis > 0 ? (element.startAtInMillis | datePattern: 'full') : '-'
        }}
      </td>
    </ng-container>

    <!-- Run Time -->
    <ng-container matColumnDef="startTime">
      <th mat-header-cell *matHeaderCellDef>Start Time</th>
      <td mat-cell *matCellDef="let element">
        {{
          element.startAtInMillis > 0 ? (element.startAtInMillis | timePattern: 'full') : '-'
        }}
      </td>
    </ng-container>

    <!-- After Event -->
    <ng-container matColumnDef="afterEvent">
      <th mat-header-cell *matHeaderCellDef>After Event</th>
      <td mat-cell *matCellDef="let element">
        {{
          element.parentId
            ? (element.paymentAlias.paymentDate | datePattern: 'full') +
              ' - ' +
              element.paymentAlias.paymentName
            : '-'
        }}
      </td>
    </ng-container>

    <!-- Finished Date -->
    <ng-container matColumnDef="finishedDate">
      <th mat-header-cell *matHeaderCellDef>End Date</th>
      <td mat-cell *matCellDef="let element">
        {{ element.endAtInMillis | datePattern: 'full' }}
      </td>
    </ng-container>

    <!-- Finished Time -->
    <ng-container matColumnDef="finishedTime">
      <th mat-header-cell *matHeaderCellDef>End Time</th>
      <td mat-cell *matCellDef="let element">{{ element.endAtInMillis | timePattern: 'full' }}</td>
    </ng-container>

    <!-- Duration -->
    <ng-container matColumnDef="duration">
      <th mat-header-cell *matHeaderCellDef>Duration (s)</th>
      <td mat-cell *matCellDef="let element">{{ element.duration }}</td>
    </ng-container>

    <ng-container matColumnDef="action">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let element">
        <div class="action__outer">
          <!--          <mat-icon>create</mat-icon>-->
          <!--          <mat-icon>format_list_bulleted</mat-icon>-->
          <mat-icon
            class="play-icon"
            [hidden]="element.state !== 'SCHEDULED'"
            (click)="clickStartJob(element)"
            >play_arrow
          </mat-icon>
          <!--          <mat-icon-->
          <!--            class="stop-icon"-->
          <!--            [hidden]="element.state !== 'RUNNING'"-->
          <!--            (click)="clickStopJob(element)"-->
          <!--            >stop</mat-icon-->
          <!--          >-->
          <!--          <mat-icon class="pause-icon" [hidden]="element.state !== 'SCHEDULED'" (click)="clickPauseJob(element)">pause</mat-icon>-->
          <mat-icon
            class="delete-icon"
            [hidden]="element.state !== 'SCHEDULED' && element.state !== 'CHAINED'"
            (click)="clickDeleteJob(element)"
            >delete
          </mat-icon>
        </div>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>
  <mat-paginator
    [pageSizeOptions]="[5, 10, 20]"
    showFirstLastButtons
    aria-label="Select page of periodic elements"
  >
  </mat-paginator>
</section>
