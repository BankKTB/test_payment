<div class="content-menu-top">
  <app-head-content></app-head-content>
  <div class="topic">
    <h4>รายละเอียดการอนุมัติเอกสารภายในวัน B เป็น ว่าง</h4>
  </div>
</div>
<div class="body">
  <div class="container-fluid">
    <mat-card>
      <mat-card-content>
        <form [formGroup]="omForm" [ngClass]="{ 'submited-form': isSubmitedForm }">
          <div class="panel panel-primary">
            <div (click)="panelExpanded = !panelExpanded" class="panel-heading pointer">
              <h3 class="panel-head">
                Selection Criteria
                <span class="float-right"
                  ><i *ngIf="!panelExpanded" class="material-icons">add</i></span
                >
                <span class="float-right"
                  ><i *ngIf="panelExpanded" class="material-icons">remove</i></span
                >
              </h3>
            </div>
            <div *ngIf="panelExpanded" class="panel-body">
              <div class="row">
                <div class="col-md-2">
                  <label class="text-underline-red input-head"> รหัสหน่วยงาน </label>
                </div>
                <div class="col-md-4">
                  <div class="input-group">
                    <input
                      class="form-control"
                      formControlName="departmentCodeFrom"
                      maxLength="5"
                      type="text"
                    />
                    <div class="input-group-append button-group-search">
                      <button
                        (click)="openDialogSearchMaster('departmentCodeFrom')"
                        class="btn btn-default"
                        type="button"
                      >
                        <img src="assets/images/icon/fa-search.svg" width="12px" />
                      </button>
                    </div>
                  </div>
                  <!--                  {{departmentCodeFromBindingName}}-->
                </div>
                <label class="input-head pt-15">ถึง </label>
                <div class="col-12 col-md-4">
                  <div class="input-group">
                    <input
                      class="form-control"
                      formControlName="departmentCodeTo"
                      maxLength="5"
                      type="text"
                    />
                    <div class="input-group-append button-group-search">
                      <button
                        (click)="openDialogSearchMaster('departmentCodeTo')"
                        class="btn btn-default"
                        type="button"
                      >
                        <img src="assets/images/icon/fa-search.svg" width="12px" />
                      </button>
                    </div>
                  </div>
                  <!--                  {{departmentCodeToBindingName}}-->
                </div>
              </div>
              <div class="row">
                <div class="col-md-2">
                  <label class="text-black input-head"> เอกสารทางการบัญชี </label>
                </div>
                <div class="col-md-4">
                  <div class="input-group">
                    <input
                      class="form-control"
                      formControlName="accDocNoFrom"
                      maxLength="10"
                      type="text"
                    />
                  </div>
                  <!--                  {{provinceCodeFromBindingName}}-->
                </div>
                <label class="input-head pt-15">ถึง </label>
                <div class="col-12 col-md-4">
                  <div class="input-group">
                    <input
                      class="form-control"
                      formControlName="accDocNoTo"
                      maxLength="10"
                      type="text"
                    />
                  </div>
                  <!--                  {{provinceCodeToBindingName}}-->
                </div>
              </div>
              <div class="row">
                <div class="col-md-2">
                  <label class="text-black input-head"> ปีบัญชี </label>
                </div>
                <div class="col-md-4">
                  <input
                    class="form-control"
                    formControlName="yearAccountFrom"
                    maxLength="4"
                    type="text"
                  />
                </div>
                <label class="input-head pt-15">ถึง </label>
                <div class="col-md-4">
                  <input
                    class="form-control"
                    formControlName="yearAccountTo"
                    maxLength="4"
                    type="text"
                  />
                </div>
              </div>
            </div>
          </div>
          <div [ngClass]="{ show: isOpenCollapseDetail }" class="collapse-detail">
            <div class="panel panel-primary">
              <div (click)="panelExpanded1 = !panelExpanded1" class="panel-heading pointer">
                <h3 class="panel-head">
                  Addition Selection
                  <span class="float-right"
                    ><i *ngIf="!panelExpanded1" class="material-icons">add</i></span
                  >
                  <span class="float-right"
                    ><i *ngIf="panelExpanded1" class="material-icons">remove</i></span
                  >
                </h3>
              </div>
              <div *ngIf="panelExpanded1" class="panel-body">
                <div class="row">
                  <div class="col-md-2">
                    <label class="text-underline-red input-head"> วันที่อนุมัติ </label>
                  </div>
                  <div class="col-md-4">
                    <div class="input-group datetime-input">
                      <div class="box-instead-input">
                        <input
                          [matDatepicker]="unblockDate"
                          class="form-control"
                          formControlName="unblockDate"
                          type="text"
                          appDateInput
                        />
                      </div>
                      <div class="datetime-input-append">
                        <button
                          (click)="unblockDate.open()"
                          class="btn-calendar-icon"
                          type="button"
                        >
                          <img src="assets/images/icon/calendar.svg" width="12px" />
                          <mat-datepicker #unblockDate></mat-datepicker>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-2">
                    <label class="text-black input-head"> เปลี่ยนสถานะจาก </label>
                  </div>
                  <div class="col-md-4">
                    <div class="input-group">
                      <input
                        [readonly]="isDisableStatus"
                        class="form-control"
                        formControlName="statusFrom"
                        maxLength="1"
                        type="text"
                      />
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-2">
                    <label class="text-black input-head"> สถานะใหม่ </label>
                  </div>
                  <div class="col-md-4">
                    <div class="input-group">
                      <input
                        [readonly]="isDisableStatus"
                        class="form-control"
                        formControlName="statusTo"
                        maxLength="1"
                        type="text"
                      />
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-2">
                    <label class="text-black input-head"> รหัสจังหวัด </label>
                  </div>
                  <div class="col-md-4">
                    <div class="input-group">
                      <input
                        class="form-control"
                        formControlName="provinceCodeFrom"
                        maxLength="4"
                        type="text"
                      />
                      <div class="input-group-append button-group-search">
                        <button
                          (click)="openDialogSearchMaster('provinceCodeFrom')"
                          class="btn btn-default"
                          type="button"
                        >
                          <img src="assets/images/icon/fa-search.svg" width="12px" />
                        </button>
                      </div>
                    </div>
                    <!--                  {{provinceCodeFromBindingName}}-->
                  </div>
                  <label class="input-head pt-15">ถึง </label>
                  <div class="col-12 col-md-4">
                    <div class="input-group">
                      <input
                        class="form-control"
                        formControlName="provinceCodeTo"
                        maxLength="4"
                        type="text"
                      />
                      <div class="input-group-append button-group-search">
                        <button
                          (click)="openDialogSearchMaster('provinceCodeTo')"
                          class="btn btn-default"
                          type="button"
                        >
                          <img src="assets/images/icon/fa-search.svg" width="12px" />
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-2">
                    <label class="text-black input-head"> หน่วยเบิกจ่าย </label>
                  </div>
                  <div class="col-md-4">
                    <div class="input-group">
                      <input
                        class="form-control"
                        formControlName="disbursementCodeFrom"
                        maxLength="10"
                        type="text"
                      />
                      <div class="input-group-append button-group-search">
                        <button
                          (click)="openDialogSearchMaster('disbursementCodeFrom')"
                          class="btn btn-default"
                          type="button"
                        >
                          <img src="assets/images/icon/fa-search.svg" width="12px" />
                        </button>
                      </div>
                    </div>
                  </div>
                  <label class="input-head pt-15">ถึง </label>
                  <div class="col-12 col-md-4">
                    <div class="input-group">
                      <input
                        class="form-control"
                        formControlName="disbursementCodeTo"
                        maxLength="10"
                        type="text"
                      />
                      <div class="input-group-append button-group-search">
                        <button
                          (click)="openDialogSearchMaster('disbursementCodeTo')"
                          class="btn btn-default"
                          type="button"
                        >
                          <img src="assets/images/icon/fa-search.svg" width="12px" />
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row mx-auto mt-3 border-t-black mb-2">
            <div class="mx-auto d-flex">
              <button (click)="onSearch()" class="btn-light" type="button">ค้นหา</button>
            </div>
          </div>
        </form>
        <ul class="warning-box">
          <li *ngFor="let c of listSearchValidate">{{ c }}</li>
        </ul>
      </mat-card-content>
    </mat-card>

    <div *ngIf="report != null">
      <div class="row">
        <div class="col-md-2">
          <label class="text-black">วันที่อนุมัติ/ยกเลิก :</label>
        </div>
        <div class="col-md-2">
          <label *ngIf="this.omForm.controls.unblockDate.value" class="text-black">
            {{ this.omForm.controls.unblockDate.value | thaidate }}
          </label>
        </div>
      </div>
      <div class="row">
        <div class="col-md-2">
          <label class="text-black">ปรับสถานะเอกสารจาก :</label>
        </div>
        <div class="col-md-2">
          <label class="text-black">B เป็น </label>
        </div>
      </div>

      <div>
        <div class="row">
          <div class="col-md-12 table-responsive long-data-table">
            <table border="1">
              <!-- Row A -->
              <tr class="theadinfo">
                <td colspan="34">วันที่อนุมัติ : {{ currentDate | thaidate }}</td>
              </tr>
              <tr class="theadinfo">
                <td colspan="34">ประมวลผลโดย : {{ userProfile.userdata.username }}</td>
              </tr>
              <tr class="theadinfo">
                <td colspan="2" style="width: 100px;">รหัส</td>
                <td colspan="2" style="width: 100px;">จาก</td>
                <td colspan="2" style="width: 150px;">ว/ท อนุมัติ</td>
                <td colspan="2" style="width: 150px;">เวลาปรับ</td>
                <td colspan="2" style="width: 100px;">หน.</td>
                <td colspan="2" style="width: 100px;">จว.</td>
                <td colspan="2" style="width: 300px;">หน่วยเบิกจ่าย</td>
                <td colspan="2" style="width: 100px;">ปภ</td>
                <td colspan="2" style="width: 150px;">ปี</td>
                <td colspan="2" style="width: 300px;">เลขเอกสาร</td>
                <td colspan="2" style="width: 150px;">ว/ทผ่านบ/ช</td>
                <td colspan="2" style="width: 100px;">PM</td>
                <td colspan="2" style="width: 300px;">จำนวนขอเบิก</td>
                <td colspan="2" style="width: 300px;">หักภาษี/ค่าปรับ</td>
                <td colspan="2" style="width: 300px;">ยอดสุทธิ</td>
                <td colspan="2" style="width: 200px;">รหัสผู้ขาย</td>
                <td colspan="2" style="width: 300px;">ผู้ขายหรือหน่วยงาน</td>
              </tr>
              <ng-container *ngFor="let item of report.items">
                <tr class="highlight-company">
                  <td colspan="34">หน่วยงาน {{ item.companyName }}</td>
                </tr>
                <tr *ngFor="let detail of item.detail" class="none-border-bottom">
                  <td colspan="2" style="width: 100px;"></td>
                  <td colspan="2" style="width: 100px;">{{ detail.status }}</td>
                  <td colspan="2" style="width: 150px;">{{ detail.unblockDate | thaidate }}</td>
                  <td colspan="2" style="width: 150px;">
                    {{ detail.unblockDate | date: 'HH:mm:ss' }}
                  </td>
                  <td colspan="2" style="width: 100px;">{{ detail.companyCode }}</td>
                  <td colspan="2" style="width: 100px;">{{ detail.area }}</td>
                  <td colspan="2" style="width: 300px;">{{ detail.paymentCenter }}</td>
                  <td colspan="2" style="width: 100px;">{{ detail.docType }}</td>
                  <td colspan="2" style="width: 150px;">{{ detail.fiscalYear }}</td>
                  <td
                    colspan="2"
                    style="width: 300px;"
                    (click)="viewDocument(detail)"
                    class="td-click"
                  >
                    {{ detail.accDocNo }}
                  </td>
                  <td colspan="2" style="width: 150px;">{{ detail.postDate | thaidate }}</td>
                  <td colspan="2" style="width: 100px;">{{ detail.paymentMethod }}</td>
                  <td colspan="2" style="width: 300px;">{{ detail.amount | bigdecimal }}</td>
                  <td colspan="2" style="width: 300px;">{{ detail.taxFee | bigdecimal }}</td>
                  <td colspan="2" style="width: 300px;">{{ detail.netPrice | bigdecimal }}</td>
                  <td colspan="2" style="width: 200px;">{{ detail.vendor }}</td>
                  <td colspan="2" style="width: 300px;">{{ detail.vendorName }}</td>
                </tr>
                <tr class="summary">
                  <td colspan="24">สรุปยอดตามหน่วยงาน {{ item.companyName }}</td>
                  <td colspan="2" style="width: 300px;">{{ item.sumAmount | bigdecimal }}</td>
                  <td colspan="2" style="width: 300px;">{{ item.sumTaxFee | bigdecimal }}</td>
                  <td colspan="2" style="width: 300px;">{{ item.sumNetPrice | bigdecimal }}</td>
                  <td colspan="4" style="width: 500px;"></td>
                </tr>
              </ng-container>
              <tr class="summary-total">
                <td colspan="24">รวมทั้งหมด</td>
                <td colspan="2" style="width: 300px;">{{ report.totalAmount | bigdecimal }}</td>
                <td colspan="2" style="width: 300px;">{{ report.totalTaxFee | bigdecimal }}</td>
                <td colspan="2" style="width: 300px;">{{ report.totalNetPrice | bigdecimal }}</td>
                <td colspan="4" style="width: 500px;"></td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
